<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>UJ Click & Send — Public</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; line-height: 1.5; }
    .wrap { max-width: 900px; margin: auto; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { font-weight: 600; display: block; margin-bottom: 4px; }
    input[type="text"], input[type="email"] { width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 8px; }
    button { padding: 0.8rem 1.1rem; font-size: 1rem; border: 0; border-radius: 10px; cursor: pointer; }
    .primary { background: black; color: white; }
    .ghost { background: #f2f2f2; }
    .note { color: #555; font-size: 0.95rem; }
    .preview { white-space: pre-wrap; background: #fbfbfb; border: 1px dashed #ddd; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>
<div class="wrap">
  <h1>UJ Click &amp; Send — Public</h1>
  <p class="note">Click the button to open your email program with a <b>unique</b> subject and body. Fill in your name and city before sending.</p>

  <div class="grid">
    <div>
      <label for="to">Recipient Email</label>
      <input id="to" type="email" value="Gary.anand@parl.gc.ca">
    </div>
    <div>
      <label for="cc">CC</label>
      <input id="cc" type="text" value="Alice.Hansen@ps-sp.gc.ca">
    </div>
    <div>
      <label for="bcc">BCC (optional)</label>
      <input id="bcc" type="text" placeholder="records@example.com">
    </div>
    <div>
      <label for="name">Recipient Name (optional)</label>
      <input id="name" type="text" placeholder="Minister Anandasangaree">
    </div>
  </div>

  <div style="margin: 1rem 0; display:flex; gap:10px; flex-wrap:wrap;">
    <button id="compose" class="primary">Compose Unique Email</button>
    <button id="preview" class="ghost">Preview Next</button>
    <button id="reset" class="ghost">Reset Pool</button>
  </div>

  <div id="status" class="note"></div>
  <div id="previewBox" class="preview" style="display:none;"></div>
</div>

<script>
const SUBJECTS = [
  "Minister, reject collective profiling of Canadians with IDF service",
  "Charter alert: discriminatory IDF labeling proposal",
  "Protect Charter rights — oppose IDF collective targeting",
  "Minister Anandasangaree: Evidence, not blanket labels",
  "Stand for equality: reject anti-IDF discrimination",
  "Case-by-case, not collective blame — uphold our Charter",
  "Reject targeting Canadians based on IDF service",
  "Support Charter freedoms — oppose IDF-based profiling",
  "Discrimination alert: labeling IDF veterans is unjust",
  "Minister, uphold Canadian values — reject IDF labels",
  "Minister, urgent: collective blame undermines justice",
  "Immediate action needed: reject discriminatory IDF label",
  "Minister, protect liberty and equality for all Canadians",
  "Stand strong for Charter rights — oppose IDF stigma",
  "Reject injustice: Canadians with IDF service deserve fairness",
  "Minister, leadership is needed on this Charter issue",
  "Protect our community — reject harmful IDF profiling",
  "Minister Anandasangaree, uphold Canadian legal principles",
  "Equality matters — reject collective labeling now",
  "Minister, stop the dangerous trend of collective blame",
  "Charter values at stake — act against IDF discrimination",
  "Minister, Canada deserves better than blanket targeting",
  "Defend fairness: oppose profiling of IDF veterans",
  "Minister, stand with Canadian Jews for equality and justice",
  "Leadership required — reject IDF-related discrimination"
];

const BODIES = Array.from({ length: 100 }, (_, i) => `
Dear Minister,

I’m writing about proposals to label Canadians who served in the IDF as a “public safety threat.”
This undermines Canada’s principles of evidence-based, individual investigation.
Such actions collide with s.2, s.7, s.11(d), and s.15 of the Charter.

I urge you to reject any collective designation tied to IDF service and reaffirm evidence-based, case-by-case assessments.

Thank you for your attention to this urgent matter.

Sincerely,
[Your Name]
[City, Postal Code]
Unapologetically Jewish
`);

function encodeCRLF(s) { return s.replace(/\r?\n/g, "\r\n"); }
function makeMailto(to, subject, body, cc, bcc) {
    const params = new URLSearchParams();
    if (subject) params.set("subject", subject);
    if (cc) params.set("cc", cc);
    if (bcc) params.set("bcc", bcc);
    if (body) params.set("body", encodeCRLF(body));
    return `mailto:${encodeURIComponent(to)}?` + params.toString();
}

function keyFor(to) { return `uj_pub_used:${to}`; }
function getUsed(to) { try { return JSON.parse(localStorage.getItem(keyFor(to)) || "[]"); } catch { return []; } }
function setUsed(to, arr) { localStorage.setItem(keyFor(to), JSON.stringify(arr)); }

function pickUniquePair(to) {
  const used = new Set(getUsed(to).map(x => `${x.s}-${x.b}`));
  const pairs = [];
  for (let i=0; i<SUBJECTS.length; i++) for (let j=0; j<BODIES.length; j++) pairs.push([i,j]);
  const unused = pairs.filter(([i,j]) => !used.has(`${i}-${j}`));
  if (!unused.length) { setUsed(to, []); return pickUniquePair(to); }
  const [s, b] = unused[Math.floor(Math.random() * unused.length)];
  const rec = getUsed(to); rec.push({ s, b, ts: Date.now() }); setUsed(to, rec);
  return { subject: SUBJECTS[s], body: BODIES[b] };
}

function nextUnique(to) {
  return pickUniquePair(to || "preview@example.com");
}

const $ = id => document.getElementById(id);
$("#compose").addEventListener("click", () => {
  const to = $("#to").value.trim();
  if (!to) { $("#status").textContent = "Enter a recipient email."; return; }
  const cc = $("#cc").value.trim();
  const bcc = $("#bcc").value.trim();
  const { subject, body } = nextUnique(to);
  const href = makeMailto(to, subject, body, cc, bcc);
  window.location.href = href;
  $("#status").textContent = `Opened a unique draft for ${to}. Used combos: ${getUsed(to).length}.`;
});

$("#preview").addEventListener("click", () => {
  const to = $("#to").value.trim() || "preview@example.com";
  const { subject, body } = nextUnique(to);
  $("#previewBox").style.display = "block";
  $("#previewBox").textContent = "Subject: " + subject + "\n\n" + body;
});

$("#reset").addEventListener("click", () => {
  const to = $("#to").value.trim();
  if (!to) { $("#status").textContent = "Enter a recipient email to reset."; return; }
  setUsed(to, []);
  $("#status").textContent = `Reset the non-repeating pool for ${to}.`;
});
</script>
</body>
</html>
